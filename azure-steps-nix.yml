  

steps:

  - bash: |
      OS_X_VER=$(sw_vers 2>/dev/null | grep BuildVer | awk '{print $2}' | cut -c1-2 || true); OS_X_VER=$((OS_X_VER-4)); [ "$OS_X_VER" -gt 0 ] || unset OS_X_VER

      commits_count=$(git log -n 999999 --date=raw --pretty=format:"%cd" | wc -l)
      echo "OS is ........................ [$OS]"
      echo "BUILD_SOURCESDIRECTORY is .... [$BUILD_SOURCESDIRECTORY]"
      echo "AGENT_BUILDDIRECTORY ......... [$AGENT_BUILDDIRECTORY]"
      echo "build number is .............. [$commits_count]"
      echo "working folder ............... [$(pwd)]"
      echo "message ...................... [$BUILD_SOURCEVERSIONMESSAGE]"
      echo "OS_X_VER ..................... [$OS_X_VER]"
      echo "uname's System ............... [$(uname -s)]"

      echo "##vso[task.setvariable variable=OS_X_VER]$OS_X_VER"
    displayName: 'INIT/MAIN [$(OS)]'

  - powershell: |
      $ErrorActionPreference = "Continue"
      & uname -a
      & df -h
      & diskutil list
      & sudo fdisk -l

      gdr -PSProvider 'FileSystem'
      & cmd /c "set | sort"
      & printenv | sort
      ""

      "env:psmodulePath is '$($env:psmodulePath)'"

      echo "OK?!"
      exit 0
    displayName: 'Show [$(OS)] Info'

  - bash: |
      msbuild /version; echo -e "\n\n\n"
      dotnet build /version; echo ""
      nuget >.1.tmp; cat .1.tmp | head -3
      nuget
      mono --version
      dotnet --info
      curl --version
      mkdir -p c:/123a
      mkdir c:/123b
      ls -la c:/123a
      ls -la c:/
      # cmd /c dir c:\\123a
      # cmd /c dir c:\\123b


      exit 0
    displayName: 'Show .NET for [$(OS)]'

  - powershell: |
      if ($Env:OS -eq "Windows") {
        get-wmiobject win32_service | where {$_.Name.ToLower().IndexOf("sql") -ge 0 } | sort-object -Property "DisplayName" | ft State, Name, DisplayName, StartMode, StartName
      }
    displayName: 'Show SQL Servers for [$(OS)]'

  - powershell: |
      if ($Env:OS -eq "Windows") {
        get-wmiobject win32_service | where { $true } | sort-object -Property "DisplayName" | ft State, Name, DisplayName, StartMode, StartName
      }
    displayName: 'Show All Windows Services for [$(OS)]'
